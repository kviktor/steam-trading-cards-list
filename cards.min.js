function getCardsJson(e){api_url="http://whateverorigin.org/get?url=";if(/^\d+$/.test(e))api_url+=encodeURIComponent("https://steamcommunity.com/profiles/"+e);else api_url+=encodeURIComponent("https://steamcommunity.com/id/"+e);api_url+=encodeURIComponent("/inventory/json/753/6?language=english");$.ajax({url:api_url,dataType:"jsonp",success:function(e){try{cards_json=$.parseJSON(e.contents)["rgDescriptions"];count_json=$.parseJSON(e.contents)["rgInventory"]}catch(t){$(".card-list").html("<h3>And error occurred! Is your Steam profile public? Did you type your Steam ID correctly?</h3>");return}for(var n in count_json){var r=count_json[n]["classid"];if(count[r])++count[r];else count[r]=1}for(var n in cards_json){if(cards_json[n]["tags"][2]["name"]!="Trading Card")continue;card={name:cards_json[n]["name"],game:cards_json[n]["tags"][1]["name"],icon_url:cards_json[n]["icon_url"],market_name:cards_json[n]["market_name"],market_hash_name:cards_json[n]["market_hash_name"],amount:count[cards_json[n]["classid"]]};if(games[card["game"]]){if(card["amount"]==1)games[card["game"]].push(card);else{var i=true;for(var s in games[card["game"]])if(games[card["game"]][s]["name"]===card["name"]){i=false;break}if(i)games[card["game"]].push(card)}}else{games[card["game"]]=[card]}}listGames()}})}function get_card(e,t,n,r){return'<div class="card-box"><div class="card-box-image"><img src="http://cdn.steamcommunity.com/economy/image/'+t+'"/></div>'+'<div class="card-box-text">'+e+" ("+r+') <br /><a target="blank" href="http://steamcommunity.com/market/listings/753/'+encodeURIComponent(n)+'">Steam market</a></div></div>'}function generateHTML(){html="";for(var e in games){html+="<h2>"+e+"</h2>";for(var t in games[e]){card=games[e][t];html+=get_card(card["name"],card["icon_url"],card["market_hash_name"],card["amount"])}html+='<div style="clear: both;"></div>'}return html}function generateRedditTable(){table="|Game|Cards\n|:-|:-:|";for(var e in games){table+="\n|"+e+"|";for(var t in games[e]){table+=games[e][t]["name"]+" ("+games[e][t]["amount"]+"), "}table=table.substr(0,table.length-2)+"|"}return table}function listGames(){$(".card-list").html(generateHTML());$("#reddit-table-button").fadeIn()}var count={};var games={};$(function(){$("#steam-id-submit").click(function(){var e=$("#steam-id").val();if(e.length>0){count={};games={};$(".card-list").html('<img src="loading.gif" id="loading"/>');$('[id^="reddit-table"]').hide();getCardsJson(e)}else{$(".card-list").html('<div id="loading">Please input your Steam ID</div>')}return false});$("#reddit-table-button").click(function(){$("#reddit-table").html(generateRedditTable());$("#reddit-table").fadeIn();return false})})
